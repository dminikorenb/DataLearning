








<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Jupyter Notebook Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">
  
  <meta name="robots" content="noindex,nofollow">
  

  <!--NEW RELIC Start Perf Measurement-->
  
  <!--NREND-->

  <!-- Le styles -->
  <link href="/static/build/styles.css?v=55ba354138253381d2c0ada9821cd4da" rel="stylesheet">

  <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- Le fav and touch icons -->
  <link rel="shortcut icon" href="/static/ico/ipynb_icon_16x16.png">
  <link rel="apple-touch-icon-precomposed" sizes="144x144"
        href="/static/ico/apple-touch-icon-144-precomposed.png?v=5a3c9ede93e2a8b8ea9e3f8f3da1a905">
  <link rel="apple-touch-icon-precomposed" sizes="114x114"
        href="/static/ico/apple-touch-icon-114-precomposed.png?v=45d86fc8f24dc00638035e1dd7a6d898">
  <link rel="apple-touch-icon-precomposed" sizes="72x72"
        href="/static/ico/apple-touch-icon-72-precomposed.png?v=540b5eb0f3cfd25f1439d1c9bd30e15f">
  <link rel="apple-touch-icon-precomposed"
        href="/static/ico/apple-touch-icon-57-precomposed.png?v=225f0590e187e1458625654f10a28f56">
  
  

  

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Notebook on nbviewer">
  <meta name="twitter:description" content="Check out this Jupyter notebook!">

  
  <meta name="twitter:domain" content="nbviewer.jupyter.org">
  <meta name="twitter:image:src" content="http://ipython.org/ipython-doc/dev/_images/ipynb_icon_128x128.png">

  
    <link href="/static/build/notebook.css?v=aae8f92f7e80fc468ae446b9d852fe90" rel="stylesheet">
  

  

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML" type="text/javascript">
    </script>
    <script type="text/javascript">
      init_mathjax = function() {
        if (window.MathJax) {
          // MathJax loaded
          MathJax.Hub.Config({
            TeX: {
              equationNumbers: {
                autoNumber: "AMS",
                useLabelIds: true
              }
            },
            tex2jax: {
              inlineMath: [ ['$','$'], ["\\(","\\)"] ],
              displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
              processEscapes: true,
              processEnvironments: true
            },
            displayAlign: 'center',
            "HTML-CSS": {
              styles: {'.MathJax_Display': {"margin": 0}},
              linebreaks: { automatic: true }
            }
          });
          MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        }
      }
      init_mathjax();
    </script>
  

  
    <script>
      (function() {
        function addWidgetsRenderer() {
          var mimeElement = document.querySelector('script[type="application/vnd.jupyter.widget-view+json"]');
          var scriptElement = document.createElement('script');
          var widgetRendererSrc = 'https://unpkg.com/@jupyter-widgets/html-manager@0.15/dist/embed-amd.js';
          var widgetState;

          try {
            widgetState = mimeElement && JSON.parse(mimeElement.innerHTML);

            if (widgetState && (widgetState.version_major < 2 || !widgetState.version_major)) {
              widgetRendererSrc = 'https://unpkg.com/jupyter-js-widgets@2.1/dist/embed.js';
            }
          } catch(e) {}

          scriptElement.src = widgetRendererSrc;
          document.body.appendChild(scriptElement);
        }

        document.addEventListener('DOMContentLoaded', addWidgetsRenderer);
      }());
    </script>
  

</head>

<body class="nbviewer">

  <!-- These are loaded at the top of the body so they are available to
       notebook cells when they are loaded below. -->
  <script src="/static/components/jquery/dist/jquery.min.js?v=a09e13ee94d51c524b7e2a728c7d4039"></script>
  <script src="/static/components/requirejs/require.js?v=6da8be361b9ee26c5e721e76c6d4afce"></script>
  <script src="/static/components/moment/min/moment.min.js?v=89f87298ad94aa1e6b92f42eb66da043"></script>
<!-- Navbar
================================================== -->
  <nav id="menubar" class="navbar navbar-default navbar-fixed-top" data-spy="affix">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <i class="fa fa-bars"></i>
        </button>
        <a class="navbar-brand" href="/">
          <img src="/static/img/nav_logo.svg?v=479cefe8d932fb14a67b93911b97d70f" width="159"/>
        </a>
      </div>

      <div class="collapse navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li>
            <a class="active" href="http://jupyter.org">JUPYTER</a>
          </li>
          <li>
    <a href="/faq" title="FAQ" >
      
        <span>FAQ</span>
      
    </a>
  </li>

          
  
    
  
    
      
        <li>
    <a href="/format/script/github/Yorko/mlcourse_open/blob/master/jupyter_russian/project_alice/week2_analysis_hypotheses.ipynb?flush_cache=true" title="View as Code" >
      <span class="fa fa-code fa-2x menu-icon"></span>
      <span class="menu-text">View as Code</span>
    </a>
  </li>
      
    
  

  
    <li>
    <a href="#" title="Python 3 Kernel" >
      <span class="fa fa-server fa-2x menu-icon"></span>
      <span class="menu-text">Python 3 Kernel</span>
    </a>
  </li>
  

  
    <li>
    <a href="https://github.com/Yorko/mlcourse_open/blob/master/jupyter_russian/project_alice/week2_analysis_hypotheses.ipynb" title="View on GitHub" >
      <span class="fa fa-github fa-2x menu-icon"></span>
      <span class="menu-text">View on GitHub</span>
    </a>
  </li>
  

  
    <li>
    <a href="https://mybinder.org/v2/gh/Yorko/mlcourse_open/master?filepath=jupyter_russian/project_alice/week2_analysis_hypotheses.ipynb" title="Execute on Binder" >
      <span class="fa fa-icon-binder fa-2x menu-icon"></span>
      <span class="menu-text">Execute on Binder</span>
    </a>
  </li>
  

  <li>
    <a href="https://raw.githubusercontent.com/Yorko/mlcourse_open/master/jupyter_russian/project_alice/week2_analysis_hypotheses.ipynb" title="Download Notebook" download>
      <span class="fa fa-download fa-2x menu-icon"></span>
      <span class="menu-text">Download Notebook</span>
    </a>
  </li>

        </ul>
      </div><!-- /.navbar-collapse -->
      
      
    </div>
  </nav>

  <div class="container container-main">
    
  
  <ol class="breadcrumb">
    
      <li>
        <a href="/github/Yorko/mlcourse_open/tree/master">mlcourse_open</a>
      </li>
    
      <li>
        <a href="/github/Yorko/mlcourse_open/tree/master/jupyter_russian">jupyter_russian</a>
      </li>
    
      <li>
        <a href="/github/Yorko/mlcourse_open/tree/master/jupyter_russian/project_alice">project_alice</a>
      </li>
    
  </ol>
  
  <div id="notebook">
    <div id="notebook-container">
      
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><center>
<img src="https://habrastorage.org/web/677/8e1/337/6778e1337c3d4b159d7e99df94227cb2.jpg"/></p>
<h2 id="&#1057;&#1087;&#1077;&#1094;&#1080;&#1072;&#1083;&#1080;&#1079;&#1072;&#1094;&#1080;&#1103;-&quot;&#1052;&#1072;&#1096;&#1080;&#1085;&#1085;&#1086;&#1077;-&#1086;&#1073;&#1091;&#1095;&#1077;&#1085;&#1080;&#1077;-&#1080;-&#1072;&#1085;&#1072;&#1083;&#1080;&#1079;-&#1076;&#1072;&#1085;&#1085;&#1099;&#1093;&quot;">&#1057;&#1087;&#1077;&#1094;&#1080;&#1072;&#1083;&#1080;&#1079;&#1072;&#1094;&#1080;&#1103; "&#1052;&#1072;&#1096;&#1080;&#1085;&#1085;&#1086;&#1077; &#1086;&#1073;&#1091;&#1095;&#1077;&#1085;&#1080;&#1077; &#1080; &#1072;&#1085;&#1072;&#1083;&#1080;&#1079; &#1076;&#1072;&#1085;&#1085;&#1099;&#1093;"<a class="anchor-link" href="#&#1057;&#1087;&#1077;&#1094;&#1080;&#1072;&#1083;&#1080;&#1079;&#1072;&#1094;&#1080;&#1103;-&quot;&#1052;&#1072;&#1096;&#1080;&#1085;&#1085;&#1086;&#1077;-&#1086;&#1073;&#1091;&#1095;&#1077;&#1085;&#1080;&#1077;-&#1080;-&#1072;&#1085;&#1072;&#1083;&#1080;&#1079;-&#1076;&#1072;&#1085;&#1085;&#1099;&#1093;&quot;">&#182;</a></h2><p><center>Автор материала: программист-исследователь Mail.Ru Group, старший преподаватель Факультета Компьютерных Наук ВШЭ <a href="https://yorko.github.io/">Юрий Кашницкий</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1><center> Capstone проект №1 <br>Идентификация пользователей по посещенным веб-страницам</h1>
<p><img src='http://i.istockimg.com/file_thumbview_approve/21546327/5/stock-illustration-21546327-identification-de-l-utilisateur.jpg'></p>
<h1><center>Неделя 2. Подготовка и первичный анализ данных</h1>
<p>На второй неделе мы продолжим подготавливать данные для дальнейшего анализа и построения прогнозных моделей. Конкретно, раньше мы определили что сессия – это последовательность из 10 посещенных пользователем сайтов, теперь сделаем длину сессии параметром, и потом при обучении прогнозных моделей выберем лучшую длину сессии.
Также мы познакомимся с предобработанными данными и статистически проверим первые гипотезы, связанные с нашими наблюдениями.</p>
<p><strong>План 2 недели:</strong></p>
<ul>
<li>Часть 1. Подготовка нескольких обучающих выборок для сравнения</li>
<li>Часть 2. Первичный анализ данных, проверка гипотез</li>
</ul>
<p><strong>В этой части проекта Вам могут быть полезны  следующие видеозаписи лекций курса "Построение выводов по данным":</strong></p>
<ul>
<li><a href="https://www.coursera.org/learn/stats-for-data-analysis/lecture/3oi53/dovieritiel-nyie-intiervaly-dlia-doli">Доверительные интервалы для доли</a></li>
<li><a href="https://www.coursera.org/learn/stats-for-data-analysis/lecture/JwmBw/binomial-nyi-kritierii-dlia-doli">Биномиальный критерий для доли</a></li>
<li><a href="https://www.coursera.org/learn/stats-for-data-analysis/lecture/GZjW7/dovieritiel-nyie-intiervaly-na-osnovie-butstriepa">Доверительные интервалы на основе бутстрепа</a></li>
</ul>
<p><strong>Кроме того, в задании будут использоваться библиотеки Python <a href="https://docs.python.org/3/library/glob.html">glob</a>, <a href="https://docs.python.org/2/library/pickle.html">pickle</a>, <a href="https://docs.python.org/3/library/itertools.html">itertools</a> и класс <a href="https://docs.scipy.org/doc/scipy-0.14.0/reference/generated/scipy.sparse.csr_matrix.html">csr_matrix</a> из scipy.sparse.</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="&#1047;&#1072;&#1076;&#1072;&#1085;&#1080;&#1077;">&#1047;&#1072;&#1076;&#1072;&#1085;&#1080;&#1077;<a class="anchor-link" href="#&#1047;&#1072;&#1076;&#1072;&#1085;&#1080;&#1077;">&#182;</a></h3><ol>
<li>Заполните код в этой тетрадке </li>
<li>Если вы проходите специализацию Яндеса и МФТИ, пошлите файл с ответами в соответствующем Programming Assignment. <br> Если вы проходите курс ODS, выберите ответы в <a href="https://docs.google.com/forms/d/13ZnT7w7foHD0uw0ynTtj7atdiCGvlltF8ThhbJCvLsc">веб-форме</a>.  </li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="&#1063;&#1072;&#1089;&#1090;&#1100;-1.-&#1055;&#1086;&#1076;&#1075;&#1086;&#1090;&#1086;&#1074;&#1082;&#1072;-&#1085;&#1077;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1080;&#1093;-&#1086;&#1073;&#1091;&#1095;&#1072;&#1102;&#1097;&#1080;&#1093;-&#1074;&#1099;&#1073;&#1086;&#1088;&#1086;&#1082;-&#1076;&#1083;&#1103;-&#1089;&#1088;&#1072;&#1074;&#1085;&#1077;&#1085;&#1080;&#1103;">&#1063;&#1072;&#1089;&#1090;&#1100; 1. &#1055;&#1086;&#1076;&#1075;&#1086;&#1090;&#1086;&#1074;&#1082;&#1072; &#1085;&#1077;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1080;&#1093; &#1086;&#1073;&#1091;&#1095;&#1072;&#1102;&#1097;&#1080;&#1093; &#1074;&#1099;&#1073;&#1086;&#1088;&#1086;&#1082; &#1076;&#1083;&#1103; &#1089;&#1088;&#1072;&#1074;&#1085;&#1077;&#1085;&#1080;&#1103;<a class="anchor-link" href="#&#1063;&#1072;&#1089;&#1090;&#1100;-1.-&#1055;&#1086;&#1076;&#1075;&#1086;&#1090;&#1086;&#1074;&#1082;&#1072;-&#1085;&#1077;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1080;&#1093;-&#1086;&#1073;&#1091;&#1095;&#1072;&#1102;&#1097;&#1080;&#1093;-&#1074;&#1099;&#1073;&#1086;&#1088;&#1086;&#1082;-&#1076;&#1083;&#1103;-&#1089;&#1088;&#1072;&#1074;&#1085;&#1077;&#1085;&#1080;&#1103;">&#182;</a></h2><p>Пока мы брали последовательности из 10 сайтов, и это было наобум. Давайте сделаем число сайтов в сессии параметром, чтоб в дальнейшем сравнить модели классификации, обученные на разных выборках – с 5, 7, 10 и 15 сайтами в сессии. Более того, пока мы брали по 10 сайтов подряд, без пересечения. Теперь давайте применим идею скользящего окна – сессии будут перекрываться.</p>
<p><strong>Пример</strong>: для длины сессии 10 и ширины окна 7 файл из 30 записей породит не 3 сессии, как раньше (1-10, 11-20, 21-30), а 5 (1-10, 8-17, 15-24, 22-30, 29-30). При этом в предпоследней сессии будет один ноль, а в последней – 8 нолей.</p>
<p>Создадим несколько выборок для разных сочетаний параметров длины сессии и ширины окна. Все они представлены в табличке ниже:</p>
<p><style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
</style></p>
<table class="tg">
  <tr>
    <th class="tg-031e">session_length -&gt;<br>window_size <br></th>
    <th class="tg-031e">5</th>
    <th class="tg-031e">7</th>
    <th class="tg-031e">10</th>
    <th class="tg-031e">15</th>
  </tr>
  <tr>
    <td class="tg-031e">5</td>
    <td class="tg-031e">v</td>
    <td class="tg-031e">v</td>
    <td class="tg-031e">v</td>
    <td class="tg-031e">v</td>
  </tr>
  <tr>
    <td class="tg-031e">7</td>
    <td class="tg-031e"></td>
    <td class="tg-031e">v</td>
    <td class="tg-031e">v</td>
    <td class="tg-031e">v</td>
  </tr>
  <tr>
    <td class="tg-031e">10</td>
    <td class="tg-031e"></td>
    <td class="tg-031e"></td>
    <td class="tg-031e"><font color='green'>v</font></td>
    <td class="tg-031e">v</td>
  </tr>
</table><p>Итого должно получиться 18 разреженных матриц – указанные в таблице 9 сочетаний параметров формирования сессий для выборок из 10 и 150 пользователей. При этом 2 выборки мы уже сделали в прошлой части, они соответствуют сочетанию параметров: session_length=10, window_size=10, которые помечены в таблице выше галочкой зеленого цвета (done).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Реализуйте функцию <em>prepare_sparse_train_set_window</em>.</p>
<p>Аргументы:</p>
<ul>
<li><em>path_to_csv_files</em> – путь к каталогу с csv-файлами</li>
<li><em>site_freq_path</em> – путь к pickle-файлу с частотным словарем, полученным в 1 части проекта</li>
<li><em>session_length</em> – длина сессии (параметр)</li>
<li><em>window_size</em> – ширина окна (параметр) </li>
</ul>
<p>Функция должна возвращать 2 объекта:</p>
<ul>
<li>разреженную матрицу <em>X_sparse</em> (двухмерная Scipy.sparse.csr_matrix), в которой строки соответствуют сессиям из <em>session_length</em> сайтов, а <em>max(site_id)</em> столбцов – количеству посещений <em>site_id</em> в сессии. </li>
<li>вектор <em>y</em> (Numpy array) "ответов" в виде ID пользователей, которым принадлежат сессии из <em>X_sparse</em></li>
</ul>
<p>Детали:</p>
<ul>
<li>Модифицируйте созданную в 1 части функцию <em>prepare_train_set</em></li>
<li>Некоторые сессии могут повторяться – оставьте как есть, не удаляйте дубликаты</li>
<li>Замеряйте время выполнения итераций цикла с помощью <em>time</em> из <em>time</em>, <em>tqdm</em> из <em>tqdm</em> или с помощью виджета <a href="https://github.com/alexanderkuk/log-progress">log_progress</a> (<a href="https://habrahabr.ru/post/276725/">статья</a> о нем на Хабрахабре)</li>
<li>150 файлов из <em>capstone_websites_data/150users/</em> должны обрабатываться за несколько секунд (в зависимости от входных параметров). Если дольше – не страшно, но знайте, что функцию можно ускорить. </li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="c1"># отключим всякие предупреждения Anaconda</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="k">import</span> <span class="n">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="k">import</span> <span class="n">tqdm_notebook</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="k">import</span> <span class="n">csr_matrix</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.proportion</span> <span class="k">import</span> <span class="n">proportion_confint</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Поменяйте на свой путь к данным</span>
<span class="n">PATH_TO_DATA</span> <span class="o">=</span> <span class="s1">&#39;capstone_user_identification&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">prepare_sparse_train_set_window</span><span class="p">(</span><span class="n">path_to_csv_files</span><span class="p">,</span> <span class="n">site_freq_path</span><span class="p">,</span> 
                                    <span class="n">session_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; ВАШ КОД ЗДЕСЬ&#39;&#39;&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Примените полученную функцию с параметрами <em>session_length=5</em> и <em>window_size=3</em> к игрушечному примеру. Убедитесь, что все работает как надо.</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X_toy_s5_w3</span><span class="p">,</span> <span class="n">y_s5_w3</span> <span class="o">=</span> <span class="n">prepare_sparse_train_set_window</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PATH_TO_DATA</span><span class="p">,</span><span class="s1">&#39;3users&#39;</span><span class="p">),</span> 
                                                       <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PATH_TO_DATA</span><span class="p">,</span><span class="s1">&#39;site_freq_3users.pkl&#39;</span><span class="p">),</span>
                                       <span class="n">session_length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>





 
 
<div id="f598d613-367f-4658-a4eb-baff89777721"></div>
<div class="output_subarea output_widget_view ">
<script type="text/javascript">
var element = $('#f598d613-367f-4658-a4eb-baff89777721');
</script>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "8528257e83674c89b3b6cc6597745b73"}
</script>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre></pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X_toy_s5_w3</span><span class="o">.</span><span class="n">todense</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[8]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>matrix([[0, 3, 1, 0, 0, 0, 1, 0, 0, 0, 0],
        [1, 1, 0, 0, 1, 0, 1, 1, 0, 0, 0],
        [0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0],
        [3, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0],
        [2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 2, 1, 0, 0, 2, 0, 0, 0, 0, 0],
        [0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0],
        [2, 2, 0, 1, 0, 0, 0, 0, 0, 0, 0],
        [3, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0],
        [1, 0, 0, 2, 1, 0, 0, 0, 0, 0, 1],
        [1, 1, 0, 2, 0, 0, 0, 0, 0, 0, 0],
        [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0]])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">y_s5_w3</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[9]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>array([1, 1, 1, 1, 1, 2, 2, 3, 3, 3, 3, 3])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Запустите созданную функцию 16 раз с помощью циклов по числу пользователей num_users (10 или 150), значениям параметра <em>session_length</em> (15, 10, 7 или 5) и значениям параметра <em>window_size</em> (10, 7 или 5). Сериализуйте все 16 разреженных матриц (обучающие выборки) и векторов (метки целевого класса – ID пользователя) в файлы <code>X_sparse_{num_users}users_s{session_length}_w{window_size}.pkl</code> и <code>y_{num_users}users_s{session_length}_w{window_size}.pkl</code>.</strong></p>
<p><strong>Чтоб убедиться, что мы все далее будем работать с идентичными объектами, запишите в список <em>data_lengths</em> число строк во всех полученных рареженных матрицах (16 значений). Если какие-то будут совпадать, это нормально (можно сообразить, почему).</strong></p>
<p><strong>На моем ноутбуке этот участок кода отработал за 26 секунд, хотя понятно, что все зависит от эффективности реализации функции <em>prepare_sparse_train_set_window</em> и мощности используемого железа. И честно говоря, моя первая реализация была намного менее эффективной (34 минуты), так что тут у Вас есть возможность оптимизировать свой код.</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="kn">import</span> <span class="nn">itertools</span>

<span class="n">data_lengths</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">num_users</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">150</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">window_size</span><span class="p">,</span> <span class="n">session_length</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">window_size</span> <span class="o">&lt;=</span> <span class="n">session_length</span> <span class="ow">and</span> <span class="p">(</span><span class="n">window_size</span><span class="p">,</span> <span class="n">session_length</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
            <span class="n">X_sparse</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39; ВАШ КОД ЗДЕСЬ &#39;&#39;&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong><font color='red'> Вопрос 1. </font>Сколько всего уникальных значений в списке <code>data_lengths</code>?</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="sd">&#39;&#39;&#39; ВАШ КОД ЗДЕСЬ &#39;&#39;&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="&#1063;&#1072;&#1089;&#1090;&#1100;-2.-&#1055;&#1077;&#1088;&#1074;&#1080;&#1095;&#1085;&#1099;&#1081;-&#1072;&#1085;&#1072;&#1083;&#1080;&#1079;-&#1076;&#1072;&#1085;&#1085;&#1099;&#1093;,-&#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1082;&#1072;-&#1075;&#1080;&#1087;&#1086;&#1090;&#1077;&#1079;">&#1063;&#1072;&#1089;&#1090;&#1100; 2. &#1055;&#1077;&#1088;&#1074;&#1080;&#1095;&#1085;&#1099;&#1081; &#1072;&#1085;&#1072;&#1083;&#1080;&#1079; &#1076;&#1072;&#1085;&#1085;&#1099;&#1093;, &#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1082;&#1072; &#1075;&#1080;&#1087;&#1086;&#1090;&#1077;&#1079;<a class="anchor-link" href="#&#1063;&#1072;&#1089;&#1090;&#1100;-2.-&#1055;&#1077;&#1088;&#1074;&#1080;&#1095;&#1085;&#1099;&#1081;-&#1072;&#1085;&#1072;&#1083;&#1080;&#1079;-&#1076;&#1072;&#1085;&#1085;&#1099;&#1093;,-&#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1082;&#1072;-&#1075;&#1080;&#1087;&#1086;&#1090;&#1077;&#1079;">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Считаем в DataFrame подготовленный на 1 неделе файл <code>train_data_10users.csv</code>. Далее будем работать с ним.</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PATH_TO_DATA</span><span class="p">,</span> <span class="s1">&#39;train_data_10users.csv&#39;</span><span class="p">),</span> 
                       <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;session_id&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[11]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>site1</th>
      <th>site2</th>
      <th>site3</th>
      <th>site4</th>
      <th>site5</th>
      <th>site6</th>
      <th>site7</th>
      <th>site8</th>
      <th>site9</th>
      <th>site10</th>
      <th>user_id</th>
    </tr>
    <tr>
      <th>session_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>193</td>
      <td>574</td>
      <td>133</td>
      <td>3</td>
      <td>133</td>
      <td>133</td>
      <td>3</td>
      <td>133</td>
      <td>203</td>
      <td>133</td>
      <td>31</td>
    </tr>
    <tr>
      <th>1</th>
      <td>415</td>
      <td>192</td>
      <td>675</td>
      <td>254</td>
      <td>133</td>
      <td>31</td>
      <td>393</td>
      <td>3634</td>
      <td>217</td>
      <td>55</td>
      <td>31</td>
    </tr>
    <tr>
      <th>2</th>
      <td>55</td>
      <td>3</td>
      <td>55</td>
      <td>55</td>
      <td>5</td>
      <td>293</td>
      <td>415</td>
      <td>333</td>
      <td>900</td>
      <td>55</td>
      <td>31</td>
    </tr>
    <tr>
      <th>3</th>
      <td>473</td>
      <td>3395</td>
      <td>473</td>
      <td>55</td>
      <td>55</td>
      <td>55</td>
      <td>55</td>
      <td>944</td>
      <td>199</td>
      <td>123</td>
      <td>31</td>
    </tr>
    <tr>
      <th>4</th>
      <td>342</td>
      <td>55</td>
      <td>5</td>
      <td>3458</td>
      <td>258</td>
      <td>211</td>
      <td>3369</td>
      <td>2096</td>
      <td>674</td>
      <td>2096</td>
      <td>31</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 14061 entries, 0 to 14060
Data columns (total 11 columns):
site1      14061 non-null int64
site2      14061 non-null int64
site3      14061 non-null int64
site4      14061 non-null int64
site5      14061 non-null int64
site6      14061 non-null int64
site7      14061 non-null int64
site8      14061 non-null int64
site9      14061 non-null int64
site10     14061 non-null int64
user_id    14061 non-null int64
dtypes: int64(11)
memory usage: 1.3 MB
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Распределение целевого класса:</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_df</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[13]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>128    2796
39     2204
207    1868
127    1712
237    1643
33     1022
50      802
31      760
100     720
241     534
Name: user_id, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Посчитаем распределение числа уникальных сайтов в каждой сессии из 10 посещенных подряд сайтов.</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">num_unique_sites</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">num_unique_sites</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[15]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>7     2308
6     2197
8     2046
5     1735
9     1394
2     1246
4     1163
3      894
10     651
1      427
dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">num_unique_sites</span><span class="p">)</span><span class="o">.</span><span class="n">hist</span><span class="p">();</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Проверьте с помощью QQ-плота и критерия Шапиро-Уилка, что эта величина распределена нормально</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong><font color='red'> Вопрос 2. </font>Распределено ли нормально число уникальных сайтов в каждой сессии из 10 посещенных подряд сайтов (согласно критерию Шапиро-Уилка)?</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="sd">&#39;&#39;&#39; ВАШ КОД ЗДЕСЬ &#39;&#39;&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Проверьте гипотезу о том, что пользователь хотя бы раз зайдет на сайт, который он уже ранее посетил в сессии из 10 сайтов. Давайте проверим с помощью биномиального критерия для доли, что доля случаев, когда пользователь повторно посетил какой-то сайт (то есть число уникальных сайтов в сессии &lt; 10) велика: больше 95% (обратите внимание, что альтернатива тому, что доля равна 95% –  одностороняя). Ответом на 3 вопрос в тесте будет полученное p-value.</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong><font color='red'> Вопрос 3. </font>Каково p-value при проверке описанной гипотезы?</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">has_two_similar</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">num_unique_sites</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pi_val</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">binom_test</span>  <span class="s1">&#39;&#39;&#39; ВАШ КОД ЗДЕСЬ &#39;&#39;&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong><font color='red'> Вопрос 4. </font>Каков 95% доверительный интервал Уилсона для доли случаев, когда пользователь повторно посетил какой-то сайт (из п. 3)?</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">wilson_interval</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39; ВАШ КОД ЗДЕСЬ &#39;&#39;&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">wilson_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span>
                                   <span class="nb">round</span><span class="p">(</span><span class="n">wilson_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Постройте распределение частоты посещения сайтов (сколько раз тот или иной сайт попадается в выборке) для сайтов, которые были посещены как минимум 1000 раз.</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">site_freqs</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39; ВАШ КОД ЗДЕСЬ &#39;&#39;&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="sd">&#39;&#39;&#39; ВАШ КОД ЗДЕСЬ &#39;&#39;&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Постройте 95% доверительный интервал для средней частоты появления сайта в выборке (во всей, уже не только для тех сайтов, что были посещены как минимум 1000 раз) на основе bootstrap. Используйте столько же bootstrap-подвыборок, сколько сайтов оказалось в исходной выборке по 10 пользователям. Берите подвыборки из посчитанного списка частот посещений сайтов – не надо заново считать эти частоты. Учтите, что частоту появления нуля (сайт с индексом 0 появлялся там, где сессии были короче 10 сайтов) включать не надо. Округлите границы интервала до 3 знаков после запятой и запишите через пробел в файл <em>answer2_5.txt</em>. Это будет ответом на 5 вопрос теста.</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong><font color='red'> Вопрос 5. </font>Каков 95% доверительный интервал для средней частоты появления сайта в выборке?</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_bootstrap_samples</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">17</span><span class="p">):</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">samples</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[32]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">stat_intervals</span><span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
    <span class="n">boundaries</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">stat</span><span class="p">,</span> 
                 <span class="p">[</span><span class="mi">100</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">boundaries</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[34]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="sd">&#39;&#39;&#39; ВАШ КОД ЗДЕСЬ &#39;&#39;&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="&#1055;&#1091;&#1090;&#1080;-&#1091;&#1083;&#1091;&#1095;&#1096;&#1077;&#1085;&#1080;&#1103;">&#1055;&#1091;&#1090;&#1080; &#1091;&#1083;&#1091;&#1095;&#1096;&#1077;&#1085;&#1080;&#1103;<a class="anchor-link" href="#&#1055;&#1091;&#1090;&#1080;-&#1091;&#1083;&#1091;&#1095;&#1096;&#1077;&#1085;&#1080;&#1103;">&#182;</a></h2><p>Что еще можно добавить по второй части проекта:</p>
<ul>
<li>можно дополнительно рассматривать сессии с параметром – длиной сессии по времени. И составить выборки, скажем, для 5-, 10-, 15- и 20-минутных сессий (это как раз пригодится в <a href="https://inclass.kaggle.com/c/catch-me-if-you-can-intruder-detection-through-webpage-session-tracking2">соревновании</a> Kaggle Inclass)</li>
<li>можно провести больше первичного анализа и проверять прочие интересные гипотезы (а больше их появится после создания признаков на следующей неделе)</li>
</ul>
<p>На 3 неделе мы займемся визуальным анализом данных и построением признаков.</p>

</div>
</div>
</div>
 


    </div>
  </div>

  </div>


  
    <footer class="footer hidden-print">
      <div class="container">
        <div class="col-md-4">
          <p>
            This website does not host notebooks, it only renders notebooks
            available on other websites.
          </p>
        </div>

        <div class="col-md-4">
          <p>
            Delivered by <a href="http://www.fastly.com/">Fastly</a>,
            Rendered by <a href="https://developer.rackspace.com/?nbviewer=awesome">Rackspace</a>
          </p>
          <p>
            nbviewer GitHub <a href="https://github.com/jupyter/nbviewer">repository</a>.
          </p>
        </div>

        <div class="col-md-4">
          
  
            
              <p>
                nbviewer version:
                <a href="https://github.com/jupyter/nbviewer/commit/f69705373d1402afd924a77712e7c63659e2b57f">
                  f697053
                </a>
              </p>
            
          
  
  <p>
    nbconvert version: <a href="https://github.com/jupyter/nbconvert/releases/tag/5.4.1">
      5.4.1
    </a>
  </p>
  

          
  
  
  <p>
    Rendered
    <span class='date' data-date='Tue, 28 May 2019 09:25:40 UTC' title='Tue, 28 May 2019 09:25:40 UTC'>(Tue, 28 May 2019 09:25:40 UTC)</span>
  </p>
  

        </div>
      </div>
    </footer>
  

  <script src="/static/components/bootstrap/js/bootstrap.min.js?v=5869c96cc8f19086aee625d670d741f9"></script>
  <script src="/static/components/headroom.js/dist/headroom.min.js?v=b0a311ea668f8e768ea375f4a7abb81c"></script>
  <script src="/static/components/headroom.js/dist/jQuery.headroom.min.js?v=f3a1bae118315d0c234afc74dc6aab71"></script>

  
  
  <script>
    $(function(){ $("#menubar").headroom({
      tolerance: 5,
      offset: 205,
      classes: {
        initial: "animated",
        pinned: "slideInDown",
        unpinned: "slideOutUp"
      }
    })});
  </script>


  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-52617120-5', 'auto',
       {'storage': 'none'});
    ga('set', 'anonymizeIp', true);
    ga('send', 'pageview');
  </script>
  
  <script>
    require({
        paths: {
          moment: "/static/components/moment/min/moment.min.js?v=89f87298ad94aa1e6b92f42eb66da043"
        }
      }, ["moment"], function(moment){
      var date = $("footer .date"),
        m = moment(new Date(date.data('date'))),
        update = function(){ date.text(m.fromNow()); };
      setInterval(update, 61*1000);
      update();
      var w = $(window).scroll(function(event){
        $("body").toggleClass("scrolled", w.scrollTop() > 0);
      });
    });
  </script>

  <!--NEW RELIC Stop Perf Measurement-->
  
  <!--NEW RELIC End-->
</body>
</html>